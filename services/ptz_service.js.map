{"version":3,"sources":["services/ptz_service.ts"],"names":[],"mappings":"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","file":"ptz_service.js","sourcesContent":["///<reference path=\"../typings/main.d.ts\" />\n///<reference path=\"../rpos.d.ts\" />\n\nimport fs = require(\"fs\");\nimport util = require(\"util\");\nimport os = require('os');\nimport SoapService = require('../lib/SoapService');\nimport { Utils }  from '../lib/utils';\nimport { Server } from 'http';\n\nvar utils = Utils.utils;\n\nclass PTZService extends SoapService {\n  ptz_service: any;\n  callback: any;\n  ptz_driver: any;\n\n  presetArray = [];\n\n  public ptzConfiguration: any;\n\n\n  constructor(config: rposConfig, server: Server, callback, ptz_driver) {\n    super(config, server);\n\n    this.ptz_service = require('./stubs/ptz_service.js').PTZService;\n    this.callback = callback;\n    this.ptz_driver = ptz_driver;\n\n    this.serviceOptions = {\n      path: '/onvif/ptz_service',\n      services: this.ptz_service,\n      xml: fs.readFileSync('./wsdl/ptz_service.wsdl', 'utf8'),\n      wsdlPath: 'wsdl/ptz_service.wsdl',\n      onReady: () => console.log('ptz_service started')\n    };\n\n    for (var i = 1; i <=  255; i++) {\n      this.presetArray.push({profileToken: 'profile_token', presetName: '', presetToken: i.toString(), used: false});\n    }  \n\n    this.extendService();\n  }\n\n\n\n\n  extendService() {\n    var port = this.ptz_service.PTZService.PTZ;\n    \n    var node = { \n      attributes : {\n        token : 'ptz_node_token_0',\n        FixedHomePosition: this.ptz_driver.hasFixedHomePosition,\n        GeoMove: false\n      },\n      Name : 'PTZ Node 0',\n      SupportedPTZSpaces : {},\n      MaximumNumberOfPresets : 255,\n      HomeSupported : this.ptz_driver.supportsGoToHome,\n      AuxiliaryCommands : ['AUX1on','AUX1off','AUX2on','AUX2off',\n      'AUX3on','AUX3off','AUX4on','AUX4off',\n      'AUX5on','AUX5off','AUX6on','AUX6off',\n      'AUX7on','AUX7off','AUX8on','AUX8off']\n    }\n    \n    if (this.ptz_driver.supportsAbsolutePTZ) {\n      node.SupportedPTZSpaces['AbsolutePanTiltPositionSpace'] = [{\n          URI : 'http://www.onvif.org/ver10/tptz/PanTiltSpaces/PositionGenericSpace',\n          XRange : { \n            Min : -1.0,\n            Max : 1.0\n          },\n          YRange : { \n            Min : -1.0,\n            Max : 1.0\n          }\n        }];\n    }\n    if (this.ptz_driver.supportsRelativePTZ) {\n      node.SupportedPTZSpaces['RelativePanTiltTranslationSpace'] = [{\n          URI : 'http://www.onvif.org/ver10/tptz/PanTiltSpaces/TranslationGenericSpace',\n          XRange : { \n            Min : -1.0,\n            Max : 1.0\n          },\n          YRange : { \n            Min : -1.0,\n            Max : 1.0\n          }\n        }];\n    }\n    if (this.ptz_driver.supportsContinuousPTZ) {\n      node.SupportedPTZSpaces['ContinuousPanTiltVelocitySpace'] = [{ \n          URI : 'http://www.onvif.org/ver10/tptz/PanTiltSpaces/VelocityGenericSpace',\n          XRange : { \n            Min : -1.0,\n            Max : 1.0\n          },\n          YRange : { \n            Min : -1.0,\n            Max : 1.0\n          }\n        }];\n      node.SupportedPTZSpaces['ContinuousZoomVelocitySpace'] =  [{ \n          URI : 'http://www.onvif.org/ver10/tptz/ZoomSpaces/VelocityGenericSpace',\n          XRange : { \n            Min : -1.0,\n            Max : 1.0\n          }\n        }];\n    }\n    if (this.ptz_driver.supportsRelativePTZ || this.ptz_driver.supportsAbsolutePTZ) {\n      node.SupportedPTZSpaces['PanTiltSpeedSpace'] = [{ \n          URI : 'http://www.onvif.org/ver10/tptz/PanTiltSpaces/GenericSpeedSpace',\n          XRange : { \n            Min : 0,\n            Max : 1\n          }\n        }];\n      node.SupportedPTZSpaces['ZoomSpeedSpace'] = [{ \n          URI : 'http://www.onvif.org/ver10/tptz/ZoomSpaces/ZoomGenericSpeedSpace',\n          XRange : { \n            Min : 0,\n            Max : 1\n          }\n        }];\n    }\n\n    // ptzConfigurations is an Array.\n    var ptzConfigurationOptions = {\n      Spaces: node.SupportedPTZSpaces,\n      PTZTimeout : { \n        Min : 'PT0S',\n        Max : 'PT10S'\n      },\n    };\n    \n    this.ptzConfiguration = {\n      attributes: {\n        token: \"ptz_config_token_0\"\n      },\n      Name: \"PTZ Configuration\",\n      UseCount: 1,\n      NodeToken: \"ptz_node_token_0\",\n      DefaultAbsolutePantTiltPositionSpace : 'http://www.onvif.org/ver10/tptz/PanTiltSpaces/PositionGenericSpace',\n      DefaultAbsoluteZoomPositionSpace : 'http://www.onvif.org/ver10/tptz/ZoomSpaces/PositionGenericSpace',\n      DefaultRelativePanTiltTranslationSpace : 'http://www.onvif.org/ver10/tptz/PanTiltSpaces/TranslationGenericSpace',\n      DefaultRelativeZoomTranslationSpace : 'http://www.onvif.org/ver10/tptz/ZoomSpaces/TranslationGenericSpace',\n      DefaultContinuousPanTiltVelocitySpace : 'http://www.onvif.org/ver10/tptz/PanTiltSpaces/VelocityGenericSpace',\n      DefaultContinuousZoomVelocitySpace : 'http://www.onvif.org/ver10/tptz/ZoomSpaces/VelocityGenericSpace',\n      DefaultPTZSpeed : { \n        PanTilt : { \n          attributes : {\n            x : 1.0,\n            y : 1.0,\n            space : 'http://www.onvif.org/ver10/tptz/PanTiltSpaces/GenericSpeedSpace'\n          }\n        },\n        Zoom : { \n          attributes : {\n            x : 1,\n            space : 'http://www.onvif.org/ver10/tptz/ZoomSpaces/ZoomGenericSpeedSpace'\n          }\n        }\n      },\n      DefaultPTZTimeout : 'PT5S'\n    }\n\n    \n    port.GetServiceCapabilities = (args) => {\n      var GetServiceCapabilitiesResponse = { \n        Capabilities : { \n          attributes : {\n            EFlip : false,\n            Reverse : false,\n            GetCompatibleConfigurations : false,\n            MoveStatus : false,\n            StatusPosition : false\n          }\n        }\n      };\n      return GetServiceCapabilitiesResponse;\n    };\n\n    port.GetConfigurationOptions = (args) => {\n      // ToDo. Check token and return a valid response or an error reponse\n      var GetConfigurationOptionsResponse = { PTZConfigurationOptions: ptzConfigurationOptions };\n      return GetConfigurationOptionsResponse;\n    };\n\n        \n    port.GetConfiguration = (args) => {\n      // ToDo. Check token and return a valid response or an error reponse\n      var GetConfigurationResponse = { PTZConfiguration: this.ptzConfiguration };\n      return GetConfigurationResponse;\n    };\n\t\n    port.GetConfigurations = (args) => {\n      var GetConfigurationsResponse = { PTZConfiguration: this.ptzConfiguration };\n      return GetConfigurationsResponse;\n    };\n\n//    port.GetCompatibleConfigurations = (args) => {\n//      var GetCompatibleConfigurationsResponse = { };\n//      return GetCompatibleConfigurationsResponse;\n//    };\n\n    port.GetNode = (args) => {\n\t  // ToDo. Check token and return a valid response or an error reponse\n      var GetNodeResponse = { PTZNode: node };\n      return GetNodeResponse;\n    };\n\n    port.GetNodes = (args) => {\n      var GetNodesResponse = { PTZNode: node };\n      return GetNodesResponse;\n    };\n\n    port.SetHomePosition = (args) => {\n      if (this.callback) this.callback('sethome', {});\n      var SetHomePositionResponse = { };\n      return SetHomePositionResponse;\n    };\n\n    port.GotoHomePosition = (args) => {\n      if (this.callback) this.callback('gotohome', {});\n      var GotoHomePositionResponse = { };\n      return GotoHomePositionResponse;\n    };\n\n    var pan = 0;\n    var tilt = 0;\n    var zoom = 0;\n    var timeout = '';\n\n    port.ContinuousMove = (args) =>  {\n      // Update values or keep last known value\n      try {pan = args.Velocity.PanTilt.attributes.x} catch (err){}; \n      try {tilt = args.Velocity.PanTilt.attributes.y} catch (err){}; \n      try {zoom = args.Velocity.Zoom.attributes.x} catch (err){}; \n      try {timeout = args.Timeout} catch (err){}; \n      if (this.callback) this.callback('ptz', { pan: pan, tilt: tilt, zoom: zoom});\n      var ContinuousMoveResponse = { };\n      return ContinuousMoveResponse;\n    };\n\n    port.AbsoluteMove = (args) =>  {\n      // Update values or keep last known value\n      try {pan = args.Position.PanTilt.attributes.x} catch (err){}; \n      try {tilt = args.Position.PanTilt.attributes.y} catch (err){}; \n      try {zoom = args.Position.Zoom.attributes.x} catch (err){}; \n      if (this.callback) this.callback('absolute-ptz', { pan: pan, tilt: tilt, zoom: zoom});\n      var AbsoluteMoveResponse = { };\n      return AbsoluteMoveResponse;\n    };\n\n    port.RelativeMove = (args) =>  {\n      // Update values or keep last known value\n      try {pan = args.Translation.PanTilt.attributes.x} catch (err){}; \n      try {tilt = args.Translation.PanTilt.attributes.y} catch (err){}; \n      try {zoom = args.Translation.Zoom.attributes.x} catch (err){}; \n      if (this.callback) this.callback('relative-ptz', { pan: pan, tilt: tilt, zoom: zoom});\n      var RelativeMoveResponse = { };\n      return RelativeMoveResponse;\n    };\n\n    port.Stop = (args) =>  {\n      // Update values (to zero) or keep last known value\n      var pan_tilt_stop = false;\n      var zoom_stop = false;\n      try {pan_tilt_stop = args.PanTilt} catch (err){}; \n      try {zoom_stop = args.Zoom} catch (err){};\n      if (pan_tilt_stop) {\n        pan = 0;\n        tilt = 0;\n      }\n      if (zoom_stop) {\n        zoom = 0;\n      } \n      if (this.callback) this.callback('ptz', { pan: pan, tilt: tilt, zoom: zoom});\n      var StopResponse = { };\n      return StopResponse;\n    };\n\n\n    //var SendAuxiliaryCommand = { \n    //  ProfileToken : { xs:string},\n    //  AuxiliaryData : { xs:string}\n    //};\n    port.SendAuxiliaryCommand = (args) => {\n      if (this.callback) this.callback('aux', { name: args.AuxiliaryData });\n      var SendAuxiliaryCommandResponse = { \n        AuxiliaryResponse : true // no idea what the value should be\n      };\n      return SendAuxiliaryCommandResponse;\n    };\n\n    port.GetPresets = (args) => {\n      var GetPresetsResponse = { Preset: [] };\n      var matching_profileToken = args.ProfileToken;\n\n      for (var i = 0 ; i < this.presetArray.length; i++) {\n        if (this.presetArray[i].profileToken === matching_profileToken\n        && this.presetArray[i].used == true) {\n          var p = {\n            attributes: {\n              token: this.presetArray[i].presetToken\n            },\n            Name: this.presetArray[i].presetName\n          };\n          GetPresetsResponse.Preset.push(p);\n        }\n      }\n      return GetPresetsResponse;\n    };\n\n\n    port.GotoPreset = (args) => {\n      var GotoPresetResponse = { };\n      var matching_profileToken = args.ProfileToken;\n      var matching_presetToken = args.PresetToken;\n\n      for (var i = 0 ; i < this.presetArray.length; i++) {\n        if (matching_profileToken === this.presetArray[i].profileToken\n        && matching_presetToken === this.presetArray[i].presetToken\n        && this.presetArray[i].used == true) {\n          if (this.callback) this.callback('gotopreset', { name: this.presetArray[i].presetName,\n            value: this.presetArray[i].presetToken });\n          break;\n        }\n      }\n      return GotoPresetResponse;\n    };\n\n    port.RemovePreset = (args) => {\n      var RemovePresetResponse = { };\n\n      var matching_profileToken = args.ProfileToken;\n      var matching_presetToken = args.PresetToken;\n\n      for (var i = 0 ; i < this.presetArray.length; i++) {\n        if (matching_profileToken === this.presetArray[i].profileToken\n        && matching_presetToken === this.presetArray[i].presetToken) {\n          this.presetArray[i].used = false;\n          if (this.callback) this.callback('clearpreset', { name: this.presetArray[i].presetName,\n            value: this.presetArray[i].presetToken });\n          break;\n        }\n      }\n\n      return RemovePresetResponse;\n    };\n\n    port.SetPreset = (args) => {\n\n      var SetPresetResponse;\n\n      var profileToken = args.ProfileToken;\n      var presetName = args.PresetName;   // used when creating a preset \n      var presetToken = args.PresetToken; // used when updating an existing preset\n\n\n      if (presetToken) {\n        for (var i = 0; i < this.presetArray.length; i++) {\n          if (profileToken === this.presetArray[i]\n          && presetToken === this.presetArray[i]) {\n            this.presetArray[i].presetName = presetName;\n            this.presetArray[i].used = true;\n           if (this.callback) this.callback('setpreset', { name: presetName,\n            value: presetToken });\n          break;\n          }\n        SetPresetResponse = { PresetToken : presetToken};\n\n        return SetPresetResponse;\n        }\n      } else {\n        // Check if the preset name is a number (special case)\n        var special_case_name = false;\n        try {\n          var preset_name_value = parseInt(presetName);\n          if (preset_name_value > 0 && preset_name_value < 255) {\n            special_case_name = true;\n          }\n        } catch (err) {\n        }\n        if (special_case_name) {\n          if (this.callback) this.callback('setpreset', { name: presetName,\n              value: presetName });\n          SetPresetResponse = { PresetToken : presetName};\n          return SetPresetResponse;\n        } else {\n          // Find the first unused token and use it\n          var new_presetToken = '';\n          for (var i = 0; i < this.presetArray.length; i++) {\n            if (profileToken === this.presetArray[i].profileToken\n            && this.presetArray[i].used == false) {\n              this.presetArray[i].presetName = presetName;\n              this.presetArray[i].used = true;\n              new_presetToken = this.presetArray[i].presetToken;\n              if (this.callback) this.callback('setpreset', { name: presetName,\n                value: new_presetToken });\n              break;\n            }\n          }\n          SetPresetResponse = { PresetToken : new_presetToken};\n          return SetPresetResponse;\n        }\n      }\n    };\n  }\n}\nexport = PTZService;\n"]}
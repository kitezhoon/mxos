{"version":3,"sources":["lib/PTZDriver.ts"],"names":[],"mappings":"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","file":"PTZDriver.js","sourcesContent":["///<reference path=\"../typings/main.d.ts\"/>\n///<reference path=\"../rpos.d.ts\"/>\n\nimport { v4l2ctl } from \"./v4l2ctl\";\n\n// PTZDriver for RPOS (Raspberry Pi ONVIF Server)\n// (c) 2016, 2017, 2018 Roger Hardiman\n// (c) 2018 Casper Meijn\n// MIT License\n//\n// This code processes the ONVIF Pan/Tilt/Zoom messages and generates a CCTV\n// PTZ protocol such as Pelco D, Pelco P and sends these PTZ commands to a Serial Port\n// or to a TCP Socket (as raw data bytes)\n// It can also generate Pan/Tilt and Fire commands for the Tenx USB Missile Launcher\n\n// Tenx USB Missile Launcher Support\n// Opens the Tenx USB Missile Launcher USB IDs 0x1130 0x0202\n// ONVIF Pan/Tilt turns the missile launcher\n// ONVIF GotoPreset fires a foam missile (any preset will work)\n\n// Pelco D PTZ Telemetry Support\n// Opens a serial port (or network stream) and sends Pelco D commands including\n// Pan, Tilt, Zoom and Preset commands. ONVIF Home Position is mapped to Preset 1.\n\n// Pimoroni Pan-Tilt HAT Support\n// Uses the Pimoroni Pan-Tilt HAT kit for the Raspberry Pi\n// with Pan and Tilt functions\n\n// For Imaging Service, commands are sent through to the V4L2 interface\n\nclass PTZDriver {\n\n  config: rposConfig;\n  tenx: any;\n  pelcod: any;\n  visca: any;\n  pan_tilt_hat: any;\n  serialPort: any;\n  stream: any;\n  supportsAbsolutePTZ: boolean = false;\n  supportsRelativePTZ: boolean = false;\n  supportsContinuousPTZ: boolean = false;\n  supportsGoToHome: boolean = false;\n  hasFixedHomePosition: boolean = true;\n\n  constructor(config: rposConfig) {\n    this.config = config;\n    let parent = this;\n\n    // Sanity checks. Do not open serial or socket if using USB Tenx driver\n    let PTZOutput = config.PTZOutput;\n    if (config.PTZDriver === 'tenx') {\n      PTZOutput = 'none';\n    }\n\n    // Sanity checks. Do not open serial or socket if using Pan-Tilt HAT\n    if (config.PTZDriver === 'pan-tilt-hat') {\n      PTZOutput = 'none';\n    }\n\n    if (config.PTZDriver === 'tenx') {\n      var TenxDriver = require('./tenx_driver');\n      this.tenx = new TenxDriver();\n      this.tenx.open();\n      this.supportsContinuousPTZ = true;\n    }\n\n    if (config.PTZDriver === 'pan-tilt-hat') {\n      var PanTiltHAT = require('pan-tilt-hat');\n      this.pan_tilt_hat = new PanTiltHAT();\n      this.supportsAbsolutePTZ = true;\n      this.supportsRelativePTZ = true;\n      this.supportsContinuousPTZ = true;\n      this.supportsGoToHome = true\n    }\n    \n    if (config.PTZDriver === 'pelcod') {\n      this.supportsContinuousPTZ = true;\n      this.supportsGoToHome = true\n      this.hasFixedHomePosition = false;\n    }\n    \n    if (config.PTZDriver === 'visca') {\n      this.supportsContinuousPTZ = true;\n      this.supportsGoToHome = true\n    }\n\n    if (PTZOutput === 'serial') {\n      var SerialPort = require('serialport');\n      this.serialPort = new SerialPort(config.PTZSerialPort, \n        {\n        baudRate: config.PTZSerialPortSettings.baudRate,\n        parity:   config.PTZSerialPortSettings.parity,\n        dataBits: config.PTZSerialPortSettings.dataBits,\n        stopBits: config.PTZSerialPortSettings.stopBits,\n        }\n      );\n \n      this.stream = this.serialPort.on(\"open\", function(err){\n          if (err) {\n            console.log('Error: '+err);\n          return;\n          } else {\n            if (parent.config.PTZDriver === 'pelcod') {\n              var PelcoD = require('node-pelcod');\n              parent.pelcod = new PelcoD(parent.stream);\n              parent.pelcod.setAddress(parent.config.PTZCameraAddress);\n            }\n            if (parent.config.PTZDriver === 'visca') {\n              parent.visca = true;\n            }\n            // Initialise other protocols here\n          }\n      });\n    }\n\n    if (PTZOutput === 'tcp') {\n      var net = require('net');\n      this.stream = new net.Socket();\n      \n      let host = config.PTZOutputURL.split(':')[0];\n      let port = config.PTZOutputURL.split(':')[1];      \n      this.stream.on('data', function(data) {  \n          console.log('PTZ Driver received socket data ' + data);\n      });\n      this.stream.on('close', function() {\n        console.log('PTZ Driver - Socket closed');\n      });\n      this.stream.on('error', function() {\n        console.log('PTZ Driver - Socket error');\n      });\n      console.log('PTZ Driver connecting to ' + host + ':' + port);\n      this.stream.connect(port, host, function() {\n        console.log('PTZ Driver connected to ' + host + ':' + port);\n\n        if (parent.config.PTZDriver === 'pelcod') {\n          var PelcoD = require('node-pelcod');\n          console.log(parent.stream);\n          parent.pelcod = new PelcoD(parent.stream);\n          parent.pelcod.setAddress(parent.config.PTZCameraAddress);\n        }\n        if (parent.config.PTZDriver === 'visca') {\n          parent.visca = true;\n        }\n        // Initialise other protocols here\n      });\n\n    }\n  }\n\n\n// Data\n//   name:\n//   value:\n//   pan:\n//   tilt:\n//   zoom:\n// Use 'arrow functions' (instead of bind) to ensure the 'this' refers to the\n// class and not to the caller's 'this'. This is required when process_ptz_command\n// is used in a callback function.\n  process_ptz_command = (command: string, data: any) => {\n    if (command==='gotohome') {\n      console.log(\"Goto Home\");\n      if (this.pelcod) this.pelcod.sendGotoPreset(1); // use preset 1 for Home\n      if (this.visca) {\n        let data: number[] = [];\n        data.push(0x81,0x01,0x06,0x04,0xff);\n        this.stream.write(new Buffer(data));\n      }\n      if (this.pan_tilt_hat) {\n        this.pan_tilt_hat.goto_home();\n      }\n    }\n    else if (command==='sethome') {\n      console.log(\"SetHome \");\n      if (this.pelcod) this.pelcod.sendSetPreset(1); // use preset 1 for Home\n    }\n    else if (command==='gotopreset') {\n      console.log(\"Goto Preset \"+ data.name + ' / ' + data.value);\n      if (this.tenx) this.tenx.fire();\n      if (this.pelcod) this.pelcod.sendGotoPreset(parseInt(data.value));\n    }\n    else if (command==='setpreset') {\n      console.log(\"Set Preset \"+ data.name + ' / ' + data.value);\n      if (this.pelcod) this.pelcod.sendSetPreset(parseInt(data.value));\n    }\n    else if (command==='clearpreset') {\n      console.log(\"Clear Preset \"+ data.name + ' / ' + data.value);\n      if (this.pelcod) this.pelcod.sendClearPreset(parseInt(data.value));\n    }\n    else if (command==='aux') {\n      console.log(\"Aux \"+ data.name);\n      if (this.pelcod) {\n        if (data.name === 'AUX1on') this.pelcod.sendSetAux(1);\n        if (data.name === 'AUX1off') this.pelcod.sendClearAux(1);\n        if (data.name === 'AUX2on') this.pelcod.sendSetAux(2);\n        if (data.name === 'AUX2off') this.pelcod.sendClearAux(2);\n        if (data.name === 'AUX3on') this.pelcod.sendSetAux(3);\n        if (data.name === 'AUX3off') this.pelcod.sendClearAux(3);\n        if (data.name === 'AUX4on') this.pelcod.sendSetAux(4);\n        if (data.name === 'AUX4off') this.pelcod.sendClearAux(4);\n        if (data.name === 'AUX5on') this.pelcod.sendSetAux(5);\n        if (data.name === 'AUX5off') this.pelcod.sendClearAux(5);\n        if (data.name === 'AUX6on') this.pelcod.sendSetAux(6);\n        if (data.name === 'AUX6off') this.pelcod.sendClearAux(6);\n        if (data.name === 'AUX7on') this.pelcod.sendSetAux(7);\n        if (data.name === 'AUX7off') this.pelcod.sendClearAux(7);\n        if (data.name === 'AUX8on') this.pelcod.sendSetAux(8);\n        if (data.name === 'AUX8off') this.pelcod.sendClearAux(8);\n      }\n    }\n    else if (command==='relayactive') {\n      console.log(\"Relay Active \"+ data.name);\n    }\n    else if (command==='relayinactive') {\n      console.log(\"Relay Inactive \"+ data.name);\n    }\n    else if (command==='ptz') {\n      console.log(\"Continuous PTZ \"+ data.pan + ' ' + data.tilt + ' ' + data.zoom);\n      var p=0.0;\n      var t=0.0;\n      var z=0.0;\n      try {p = parseFloat(data.pan)} catch (err) {}\n      try {t = parseFloat(data.tilt)} catch (err) {}\n      try {z = parseFloat(data.zoom)} catch (err) {}\n      if (this.tenx) {\n        if      (p < -0.1 && t >  0.1) this.tenx.upleft();\n        else if (p >  0.1 && t >  0.1) this.tenx.upright();\n        else if (p < -0.1 && t < -0.1) this.tenx.downleft();\n        else if (p >  0.1 && t < -0.1) this.tenx.downright();\n        else if (p >  0.1) this.tenx.right();\n        else if (p < -0.1) this.tenx.left();\n        else if (t >  0.1) this.tenx.up();\n        else if (t < -0.1) this.tenx.down()\n        else this.tenx.stop();\n      }\n      if (this.pelcod) {\n        this.pelcod.up(false).down(false).left(false).right(false);\n        if      (p < 0 && t > 0) this.pelcod.up(true).left(true);\n        else if (p > 0 && t > 0) this.pelcod.up(true).right(true);\n        else if (p < 0 && t < 0) this.pelcod.down(true).left(true);\n        else if (p > 0 && t < 0) this.pelcod.down(true).right(true);\n        else if (p > 0) this.pelcod.right(true);\n        else if (p < 0) this.pelcod.left(true);\n        else if (t > 0) this.pelcod.up(true);\n        else if (t < 0) this.pelcod.down(true);\n\n        // Set Pan/Tilt speed\n        // scale speeds from 0..1 to 0..63\n        var pan_speed = Math.round(Math.abs(p) * 63.0 );\n        var tilt_speed = Math.round(Math.abs(t) * 63.0 );\n\n        this.pelcod.setPanSpeed(pan_speed);\n        this.pelcod.setTiltSpeed(tilt_speed);\n\n\n        this.pelcod.zoomIn(false).zoomOut(false);\n        if (z>0) this.pelcod.zoomIn(true);\n        if (z<0) this.pelcod.zoomOut(true);\n\n        // Set Zoom speed\n        // scale speeds from 0..1 to 0 (slow), 1 (low med), 2 (high med), 3 (fast)\n        var abs_z = Math.abs(z);\n        var zoom_speed = 0;\n        if (abs_z > 0.75) zoom_speed = 3;\n        else if (abs_z > 0.5) zoom_speed = 2;\n        else if (abs_z > 0.25) zoom_speed = 1;\n        else zoom_speed = 0;\n\n        // sendSetZoomSpeed is not in node-pelcod yet so wrap with try/catch\n        try {\n          if (z != 0) this.pelcod.sendSetZoomSpeed(zoom_speed);\n        } catch (err) {}\n\n        this.pelcod.send();\n      }\n      if (this.visca) {\n        // Map ONVIF Pan and Tilt Speed 0 to 1 to VISCA Speed 1 to 0x18\n        // Map ONVIF Zoom Speed (0 to 1) to VISCA Speed 0 to 7\n        let visca_pan_speed = ( Math.abs(p) * 0x18) / 1.0;\n        let visca_tilt_speed = ( Math.abs(t) * 0x18) / 1.0;\n        let visca_zoom_speed = ( Math.abs(z) * 0x07) / 1.0;\n\n        // rounding check. Visca Pan/Tilt to be in range 0x01 .. 0x18\n        if (visca_pan_speed === 0) visca_pan_speed = 1;\n        if (visca_tilt_speed === 0) visca_tilt_speed = 1;\n\n        if (this.config.PTZDriver === 'visca') {\n          let data: number[] = [];\n          if      (p < 0 && t > 0) { // upleft\n            data.push(0x81,0x01,0x06,0x01,visca_pan_speed,visca_zoom_speed,0x01,0x01,0xff);\n          }\n          else if (p > 0 && t > 0) { // upright\n            data.push(0x81,0x01,0x06,0x01,visca_pan_speed,visca_zoom_speed,0x02,0x01,0xff);\n          }\n          else if (p < 0 && t < 0) { // downleft;\n            data.push(0x81,0x01,0x06,0x01,visca_pan_speed,visca_zoom_speed,0x01,0x02,0xff);\n          }\n          else if (p >  0 && t < 0) { // downright;\n            data.push(0x81,0x01,0x06,0x01,visca_pan_speed,visca_zoom_speed,0x02,0x02,0xff);\n          }\n          else if (p > 0) { // right\n            data.push(0x81,0x01,0x06,0x01,visca_pan_speed,0x00,0x02,0x03,0xff);\n          }\n          else if (p < 0) { // left\n            data.push(0x81,0x01,0x06,0x01,visca_pan_speed,0x00,0x01,0x03,0xff);\n          }\n          else if (t > 0) { // up\n            data.push(0x81,0x01,0x06,0x01,0x00,visca_tilt_speed,0x03,0x01,0xff);\n          }\n          else if (t < 0) { // down\n            data.push(0x81,0x01,0x06,0x01,0x00,visca_tilt_speed,0x03,0x02,0xff);\n          }\n          else { // stop \n            data.push(0x81,0x01,0x06,0x01,0x00,0x00,0x03,0x03,0xff);\n          }\n\n          // Zoom\n          if (z < 0) { // zoom out\n            data.push(0x81,0x01,0x04,0x07,(0x30 + visca_zoom_speed),0xff);\n          }\n          else if (z > 0) { // zoom in\n            data.push(0x81,0x01,0x04,0x07,(0x20 + visca_zoom_speed),0xff);\n          } else { // zoom stop\n            data.push(0x81,0x01,0x04,0x07,0x00,0xff);\n          }\n\n          this.stream.write(new Buffer(data));\n        }\n      }\n      if (this.pan_tilt_hat) {\n        // Map ONVIF Pan and Tilt Speed 0 to 1 to Speed 0 to 15\n        let pan_speed  = ( Math.abs(p) * 15) / 1.0;\n        let tilt_speed = ( Math.abs(t) * 15) / 1.0;\n\n        // rounding check.\n        if (pan_speed > 15) pan_speed = 15;\n        if (tilt_speed > 15) tilt_speed = 15;\n        if (pan_speed < 0) pan_speed = 0;\n        if (tilt_speed < 0) tilt_speed = 0;\n\n        if (p < 0)  this.pan_tilt_hat.pan_left(pan_speed);\n        if (p > 0)  this.pan_tilt_hat.pan_right(pan_speed);\n        if (p == 0) this.pan_tilt_hat.pan_right(0); // stop\n        if (t < 0)  this.pan_tilt_hat.tilt_down(tilt_speed);\n        if (t > 0)  this.pan_tilt_hat.tilt_up(tilt_speed);\n        if (t == 0) this.pan_tilt_hat.tilt_down(0); // stop\n      }\n    }\n    else if (command==='absolute-ptz') {\n      console.log(\"Absolute PTZ \"+ data.pan + ' ' + data.tilt + ' ' + data.zoom);\n      var p=0.0;\n      var t=0.0;\n      var z=0.0;\n      try {p = parseFloat(data.pan)} catch (err) {}\n      try {t = parseFloat(data.tilt)} catch (err) {}\n      try {z = parseFloat(data.zoom)} catch (err) {}\n      if (this.pan_tilt_hat) {\n          let new_pan_angle = p * 90.0\n          this.pan_tilt_hat.pan(Math.round(new_pan_angle));\n          \n          let new_tilt_angle = t * 80.0\n          this.pan_tilt_hat.tilt(Math.round(new_tilt_angle));\n      }\n    }\n    else if (command==='relative-ptz') {\n      console.log(\"Relative PTZ \"+ data.pan + ' ' + data.tilt + ' ' + data.zoom);\n      var p=0.0;\n      var t=0.0;\n      var z=0.0;\n      try {p = parseFloat(data.pan)} catch (err) {}\n      try {t = parseFloat(data.tilt)} catch (err) {}\n      try {z = parseFloat(data.zoom)} catch (err) {}\n      if (this.pan_tilt_hat) {\n          let pan_degrees = p * 90.0\n          let new_pan_angle = this.pan_tilt_hat.pan_position - pan_degrees;\n          this.pan_tilt_hat.pan(Math.round(new_pan_angle));\n          \n          let tilt_degrees = t * 80.0\n          let new_tilt_angle = this.pan_tilt_hat.tilt_position - tilt_degrees;\n          this.pan_tilt_hat.tilt(Math.round(new_tilt_angle));\n      }\n    }\n    else if (command==='brightness') {\n      console.log(\"Set Brightness \"+ data.value);\n      v4l2ctl.SetBrightness(data.value);\n    }\n    else if (command==='focus') {\n      console.log(\"Focus \"+ data.value);\n      if (this.pelcod) {\n        if (data.value < 0) this.pelcod.focusNear(true);\n        else if (data.value > 0) this.pelcod.focusFar(true);\n        else {\n          this.pelcod.focusNear(false);\n          this.pelcod.focusFar(false);\n        }\n        this.pelcod.send();\n      }\n    }\n    else if (command==='focusstop') {\n      console.log(\"Focus Stop\");\n      if (this.pelcod) {\n        this.pelcod.focusNear(false);\n        this.pelcod.focusFar(false);\n        this.pelcod.send();\n      }\n    }\n    else {\n      if (!data.value) {\n        console.log(\"Unhandled PTZ/Imaging Command Received: \" + command);\n      } else {\n        console.log(\"Unhandled PTZ/Imaging Command Received: \" + command + ' Value:' + data.value);\n      }\n    }\n  }\n}\n\nexport = PTZDriver;\n"]}